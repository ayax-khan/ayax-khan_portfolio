// Prisma schema for portfolio
// Run: pnpm prisma:generate
// Migrations: pnpm prisma:migrate

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AnalyticsEventType {
  PAGE_VIEW
  CLICK
  PROJECT_INTEREST
}

model Setting {
  key       String   @id
  value     Json
  updatedAt DateTime @updatedAt
}

model BlogPost {
  id              String   @id @default(cuid())
  slug            String   @unique
  title           String
  summary         String?
  content         String   // markdown
  metaTitle       String?
  metaDescription String?
  tags            String[]
  categories      String[]
  published       Boolean  @default(false)
  publishedAt     DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([published, publishedAt])
}

// Cache any GitHub API response we care about.
// We cache by (owner, repo, kind, argsHash).
model GithubApiCache {
  id        String   @id @default(cuid())
  owner     String
  repo      String
  kind      String   // e.g. "repo", "repos", "commits"
  argsHash  String   // stable hash of query params/path
  etag      String?
  body      Json
  fetchedAt DateTime @default(now())
  expiresAt DateTime

  @@unique([owner, repo, kind, argsHash])
  @@index([expiresAt])
}

// Store portfolio-specific overrides for a GitHub repo
model ProjectOverride {
  id            String   @id @default(cuid())
  repoFullName  String   @unique // e.g. "owner/name"
  visible       Boolean  @default(true)
  featured      Boolean  @default(false)
  demoUrl       String?
  customTitle   String?
  customSummary String?
  tags          String[]
  sortOrder     Int?
  updatedAt     DateTime @updatedAt
  createdAt     DateTime @default(now())

  @@index([visible, featured])
}

model ContactMessage {
  id        String   @id @default(cuid())
  name      String
  email     String
  message   String
  ipHash    String?
  userAgent String?
  createdAt DateTime @default(now())

  @@index([createdAt])
}

model AnalyticsEvent {
  id        String             @id @default(cuid())
  type      AnalyticsEventType
  path      String
  referrer  String?
  meta      Json?
  createdAt DateTime           @default(now())

  @@index([type, createdAt])
  @@index([path, createdAt])
}
